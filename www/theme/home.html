<!DOCTYPE html>
<html lang="en">

<head>

<!-- Meta Tag -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- SEO -->
<meta name="description" content="A full-stack, REST-based, blog and web content micro-framework in an executable jar file powered by the jvm.">
<meta name="author" content="jarredweb">
<meta name="url" content="http://www.jarredweb.com">
<meta name="copyright" content="jarredweb">
<meta name="robots" content="index,follow">

<title>${site.mapValues.title}</title>

<!-- Favicon -->
<link rel="shortcut icon" href="/theme/images/favicon/favicon.ico">
<link rel="apple-touch-icon" sizes="144x144" type="image/x-icon" href="/theme/images/favicon/apple-touch-icon.png">

<!-- All CSS Plugins -->
<link rel="stylesheet" type="text/css" href="/theme/css/plugin.css">

<!-- Main CSS Stylesheet -->
<link rel="stylesheet" type="text/css" href="/theme/css/style.css">

<!-- Google Web Fonts  -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700|Merriweather">

<!-- Widgets -->
<link rel="import" id="blog-subscribe-template" href="/theme/widgets/blog-subscribe.html">
<link rel="import" id="alert-feedback-template" href="/theme/widgets/alert-feedback.html">
<link rel="import" id="theme-footer-template" href="/theme/widgets/theme-footer.html">


<!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
<!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


</head>

<body>

	<!-- Preloader Start -->
	<div class="preloader">
		<div class="rounder"></div>
	</div>
	<!-- Preloader End -->


	<!-- Popup Search Box Start -->
	<div class="header-search open-search">
		<div class="container">
			<div class="row">
				<div class="col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1">
					<div class="navbar-search">
						<form class="search-global">
							<input type="text" placeholder="Type then enter" autocomplete="off" name="search-query" value="" class="search-global-input" />
							<button class="search-global-btn">
								<i class="icon-magnifier"></i>
							</button>
							<div class="search-global-note">${site.mapValues.queryText}</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<button type="button" class="search-close close">
			<i class="fa fa-times"></i>
		</button>
	</div>
	<!-- Popup Search Box End -->


	<div id="main">
		<div class="container">
			<div class="row">

				<!-- Content Start -->
				<div class="col-md-10 col-md-offset-1">
					<div class="col-md-12 page-body">
						<div class="row">


							<div class="sub-title">
								<a href="/home"><h2>${site.mapValues.homeTitle}</h2></a> <a href="#" class="btn-header-search"><i class="icon-magnifier"></i></a>
							</div>

							<div class="col-md-12 content-page">

								<template v-for="(blog, index) in blogs"> <blog-post :index="index" :blog="blog"></blog-post> </template>

								<div class="col-md-12 text-center">
									<a href="javascript:void(0)" id="load-more-post" class="load-more-button">${site.mapValues.loadBtnText}</a>
									<div id="post-end-message"></div>
								</div>

							</div>
							
							<alert-feedback></alert-feedback>

						</div>


						<!-- Subscribe Form Start -->
						<blog-subscribe></blog-subscribe>
						<!-- Subscribe Form End -->

					</div>


					<!-- Footer Start -->
					<theme-footer></theme-footer>
					<!-- Footer End -->

				</div>
				<!-- Content End -->

			</div>
		</div>
	</div>

	<!-- Back to Top Start -->
	<a href="#" class="scroll-to-top"><i class="fa fa-long-arrow-up"></i></a>
	<!-- Back to Top End -->


	<!-- Blog Post Start -->
	<template id="blog-post-template">
	<div class="col-md-12 blog-post" :style="displayStyle(index)">
		<div class="post-title">
			<a :href="readBlog(blog._id)"><h1>{{blog.title}}</h1></a>
		</div>
		<div class="post-info">
			<span>{{blog.publishDate}} / By <a href="category.html">{{blog.author.name}}</a></span>
		</div>

		<div v-html="blog.summary"></div>

		<a :href="readBlog(blog._id)" class="button button-style button-anim fa fa-long-arrow-right"><span>${site.mapValues.readMoreText}</span></a>
	</div>
	</template>
	<!-- Blog Post End -->


	<!-- All Javascript Plugins  -->
	<script type="text/javascript" src="/theme/js/jquery.min.js"></script>

	<!-- Main Javascript File  -->
	<script type="text/javascript" src="/theme/js/plugin.js"></script>
	<script type="text/javascript" src="/theme/js/scripts.js"></script>

	<!-- Vue js -->
	<script type="text/javascript" src="/theme/js/vue.min.js"></script>

	<!-- Vuex -->
	<script src="/theme/js/vuex.min.js"></script>
	
	<!-- widgets -->
	<script src="/theme/js/widgets.js"></script>

	<script>

	//create store
	const store = new Vuex.Store({
	  	state: {
	  		blogs: [],
			_id: '',
			page: {
				num: 1,
				size: 3,
				start: 0
			},
			userInfo: {}
		},
		getters: {
			selectedBlog(state){
				let val = state.blogs.filter(x=>x._id == state._id);
				return val.length > 0? val[0] : {}
			},
			pagerBlogList(state){
				let pageNum = state.page.num;
				let pageSize = state.page.size;
				let listLen = state.blogs.length;
				let startIndex = state.page.start;
				let nextStartIndex =  ((pageNum - 1) * pageSize) + pageSize;
				let endIndex = nextStartIndex > listLen? listLen : nextStartIndex;
				return state.blogs.slice(startIndex, endIndex);
			}
		},
		mutations: {
			refreshBlogs(state, blogs){
				state.blogs = blogs;
			},
			updateBlog(state, blog){
				let i = state.blogs.findIndex(e=>e._id = blog._id);
				state.blogs.splice(i, 1, blog);
			}
		}
	});

	var BlogPost = Vue.component("blog-post", {
		template: "#blog-post-template",
		props: ['blog','index'],
		methods: {
			readBlog(id){
				return "/blog/" + id;
			},
			displayStyle(){
				if(this.index < 3){
					return "display:block";
				}
			}
		}
	});
	
	var app = new Vue({
		el: '#main',
	  	data: {},
	  	computed: {
	  		blogs(){
	  			return store.state.blogs
	  		}
	  	},
		mounted (){
			//load initial data
			$.ajax({
				url: "/blog",
				type: "get",
				dataType: "json",
				success: function(data){
					console.log(data);
					store.commit('refreshBlogs', data.blogs);
				}
			});
			
			/** Submit search request **/
		    let search = $("input[name='search-query']");
		    search.keypress(function(e){
		    	var key = e.which;
		    	if(key == 13){
		    		$.ajax({
		    			url: '/blog/search?' + search.val(),
		    			type: 'get',
		    			success: function(data){
		    				console.log(data);
							store.commit('refreshBlogs', data.blogs);
		    			},
		    			error: function(xhr){
		    				console.log(xhr.responseText)
		    			}
		    		});
		    		$(".header-search").removeClass("open");
		    		return false;
		    	}
		    })
		}
	});
	</script>
</body>
</html>
